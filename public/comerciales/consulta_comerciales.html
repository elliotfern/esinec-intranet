DETALLE EQUIPO CESC-BRIAN
SELECT mes, SUM(total_facturas) AS total_facturas, SUM(total_comision) AS total_comision
FROM (
    SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           COUNT(*) AS total_facturas,
           SUM(p2.meta_value) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_1'
      AND p1.meta_value = 'Braian-Cesc'
      AND p2.meta_key = 'comision_1'
    GROUP BY mes

    UNION ALL

    SELECT DATE_FORMAT(date, '%Y-%m') AS mes,
           COUNT(*) AS total_facturas,
           SUM(comision1 + comision2) AS total_comision
    FROM txsxekgr_intranet.facturas
    WHERE comisionista1 = 5 AND comisionista2 = 5 
    GROUP BY mes
) AS combined_data
GROUP BY mes
ORDER BY mes

///


orden por mes
SELECT mes, SUM(total_comision) AS total_comision_sum
FROM (
    SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_1'
      AND p1.meta_value = 'Braian-Cesc'
      AND p2.meta_key = 'comision_1'
    GROUP BY mes

    UNION ALL

    SELECT DATE_FORMAT(date, '%Y-%m') AS mes,
           SUM(comision1 + comision2) AS total_comision
    FROM txsxekgr_intranet.facturas
    WHERE comisionista1 = 5 AND comisionista2 = 5 
    GROUP BY mes
) AS combined_data
GROUP BY mes
ORDER BY mes


// calculo Braian-CescSELECT mes, SUM(total_comision) AS total_comision_sum
SELECT mes, SUM(total_comision) AS total_comision_sum
FROM (
    SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value/2) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_1'
      AND p1.meta_value = 'Braian-Cesc'
      AND p2.meta_key = 'comision_1'
    GROUP BY mes

    UNION ALL
    
     SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value/3) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_1'
      AND p1.meta_value = 'Braian-Carmeta-Sil'
      AND p2.meta_key = 'comision_1'
    GROUP BY mes

    UNION ALL
    
    SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value/3) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_2'
      AND p1.meta_value = 'Braian-Carmeta-Sil'
      AND p2.meta_key = 'comision_2'
    GROUP BY mes

    UNION ALL
    
     SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value/3) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_1'
      AND p1.meta_value = 'Braian'
      AND p2.meta_key = 'comision_1'
    GROUP BY mes

    UNION ALL
    
    SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value/3) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_2'
      AND p1.meta_value = 'Braian'
      AND p2.meta_key = 'comision_2'
    GROUP BY mes

    UNION ALL
    
    SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_2'
      AND p1.meta_value = 'Braian'
      AND p2.meta_key = 'comision_2'
    GROUP BY mes

    UNION ALL
    
     SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value/2) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_2'
      AND p1.meta_value = 'Braian-Cesc'
      AND p2.meta_key = 'comision_2'
    GROUP BY mes

    UNION ALL
    
    SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value/3) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_1'
      AND p1.meta_value = 'Braian-Cesc-Sil'
      AND p2.meta_key = 'comision_1'
    GROUP BY mes

    UNION ALL
    
    SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value/3) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_2'
      AND p1.meta_value = 'Braian-Cesc-Sil'
      AND p2.meta_key = 'comision_2'
    GROUP BY mes

    UNION ALL
    
    SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value/3) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_1'
      AND p1.meta_value = 'Abraham-Brain-Vanesa'
      AND p2.meta_key = 'comision_1'
    GROUP BY mes

    UNION ALL
    
     SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value/3) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_2'
      AND p1.meta_value = 'Abraham-Brain-Vanesa'
      AND p2.meta_key = 'comision_2'
    GROUP BY mes

    UNION ALL

    SELECT DATE_FORMAT(date, '%Y-%m') AS mes,
       SUM(CASE WHEN comisionista1 = comisionista2 AND comisionista1 = 2 THEN comision1 + comision2
                WHEN comisionista1 = 2 THEN comision1
                ELSE comision2 END) AS total_comision
    FROM txsxekgr_intranet.facturas
    WHERE comisionista1 = 5 OR comisionista2 = 5
    GROUP BY mes
    ORDER BY mes
) AS combined_data
GROUP BY mes
ORDER BY mes


AITOR

SELECT mes, SUM(total_comision) AS total_comision_sum
FROM (
    SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_1'
      AND p1.meta_value = 'Aitor'
      AND p2.meta_key = 'comision_1'
    GROUP BY mes

    UNION ALL
    
     SELECT DATE_FORMAT(p.post_date, '%Y-%m') AS mes,
           SUM(p2.meta_value) AS total_comision
    FROM txsxekgr_esinec.wp_postmeta p1
    JOIN txsxekgr_esinec.wp_postmeta p2 ON p1.post_id = p2.post_id
    JOIN txsxekgr_esinec.wp_posts p ON p1.post_id = p.ID
    WHERE p1.meta_key = 'comisionista_2'
      AND p1.meta_value = 'Aitor'
      AND p2.meta_key = 'comision_2'
    GROUP BY mes

    UNION ALL

    SELECT DATE_FORMAT(date, '%Y-%m') AS mes,
       SUM(CASE WHEN comisionista1 = comisionista2 AND comisionista1 = 2 THEN comision1 + comision2
                WHEN comisionista1 = 2 THEN comision1
                ELSE comision2 END) AS total_comision
FROM txsxekgr_intranet.facturas
WHERE comisionista1 = 2 OR comisionista2 = 2
GROUP BY mes
ORDER BY mes
) AS combined_data
GROUP BY mes
ORDER BY mes